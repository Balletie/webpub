# See http://wiki.archlinux.org/index.php/Python_Package_Guidelines for more
# information on Python packaging.

# Maintainer: Skip
_repo_url="https://github.com/Balletie/webpub"
_sphinx_ext_repo_url="https://github.com/Balletie/sphinx-click"
pkgname=webpub
pkgver=1.0
pkgrel=1
pkgdesc=""
arch=('x86_64')
url="$_repo_url"
license=('unknown')
groups=()
depends=( 'python'
          'python-lxml'
          'python-html5-parser'
          'python-webencodings'
          'python-requests'
          'python-chardet'
          'python-certifi'
          'python-idna'
          'python-urllib3'
          'python-cssselect'
          'python-cssutils'
          'python-click'
          'python-jinja'
          'python-markupsafe'
          'python-mimeparse'
          )
makedepends=('python-pip' 'python-sphinx' 'python-click')
provides=()
conflicts=()
replaces=()
backup=()
options=(!emptydirs)
install=
source=("git+$_repo_url"
        "git+$_sphinx_ext_repo_url")
md5sums=('SKIP'
         'SKIP')

prepare() {
  cd "$srcdir/webpub"
  git submodule init
  git config submodule.sphinx-click.url $srcdir/sphinx-click
  git submodule update
}

build() {
  cd ${srcdir}/${pkgname}/docs
  make man
}

package() {
  cd "$srcdir/webpub"
  PIP_CONFIG_FILE=/dev/null pip install --isolated --root="$pkgdir" --ignore-installed --no-deps dependency-injection git+https://github.com/Balletie/inxs.git
  python setup.py install --root="$pkgdir/" --optimize=1

  install -v -m755 -d "${pkgdir}/usr/share/man/man1"
  for file in docs/_build/man/*;do
      install -v -m644 "$file" "${pkgdir}/usr/share/man/man1/"
  done
}

# vim:set ts=2 sw=2 et:
